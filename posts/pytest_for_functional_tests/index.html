<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Using Pytest for Testing Deployments</title>
	<meta name="description" content="How to use Pytest to test deployments, batch processes, and other long-running things">
	<link rel="stylesheet" href="/css/index.css">
	<link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
	<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml"
		  title="lilatomic">
	<link rel="alternate" href="/feed/feed.json" type="application/json"
		  title="lilatomic">
</head>
<body>
<div class="ctn">
	<header>
		<h1 class="home"><a id="home" href="/">lilatomic</a></h1>
	</header>
	<div id="main">
		<main  class="tmpl-post" >

			
<article>
<h1>Using Pytest for Testing Deployments</h1>

<aside id="tagbox">
<p>Tags</p>

  <a href="/tags/python/" class="post-tag">python</a>
  <a href="/tags/infra/" class="post-tag">infra</a>
  <a href="/tags/using/" class="post-tag">using</a>
</aside>





<aside id="toc">
	<nav class="toc" >
        <ol><li><a href="#why">Why</a></li><li><a href="#what">What</a></li><li><a href="#how">How</a></li><li><a href="#full-solution">Full Solution</a></li></ol>
      </nav>
</aside>

<div class="content">
<!-- prettier-ignore-start -->
<!-- prettier-ignore-end -->
<h1 id="using-pytest-for-testing-deployments" tabindex="-1"><a class="direct-link" href="#using-pytest-for-testing-deployments">Using Pytest for Testing Deployments</a></h1>
<p><a href="#full-solution">Jump to example solution</a></p>
<h2 id="why" tabindex="-1"><a class="direct-link" href="#why">Why</a></h2>
<p>Functional tests are tests against the whole application, as deployed. And if you're doing stuff in the Cloud :tm:, the Infrastructure is the Application, in many cases. So you <em>should</em> be doing functional tests, to ensure that you are using the <abbr title="Software as a Service">SaaS</abbr> offerings correctly, and you may need to be in order to test the application at all. Also, if you're doing <abbr title="Continuous delivery">CD</abbr> or if people are deploying/installing your application, you might want to test that process.</p>
<p>One of the problems with testing deployments is that the process can be fairly lengthy (maybe it needs to spin up a <abbr title="Database">DB</abbr> or <abbr title="Kubernetes">K8s</abbr> cluster). Tests will require the same Deployment step, though might have different setups. For example, you might have an application which can receive events from a messagequeue, a storage account, or from HTTP requests through an API Gateway. You would want to test that it consumes from all 3 sources, and would need to set up those test resources individually; but it's the same application under test.</p>
<p>This type of setup can be generalised to any sort of batch process. For example, you might be testing infrastructure compliance tooling, where you trigger the &quot;evaluate&quot; function and <em>all</em> resources will be scanned and remediated. Triggering the &quot;evaluate&quot; multiple times is time-prohibitive and unnecessary, since each compliance rule will be evaluated individually. Another example would be a service which needs to be submitted to a job processor. It might be impractical to submit individual jobs for every test, because of per-job overhead.</p>
<h2 id="what" tabindex="-1"><a class="direct-link" href="#what">What</a></h2>
<p>In this situation, we'd like to have: 1. several tests : It is critical that these tests are independent and look like normal tests. Solutions which will involve collecting a pile of assertions (or worse, asserting them sequentially so you only get the first failure) 2. with individual setup steps (as stated above, they may have different requirements) 3. sharing a common setup step (this is the big, time-consuming step) 4. which occurs after the individual setups (if the setups occur after big deploy step, it is actually pretty easy to do with pytest, since their failure wouldn't count as a failed prerequisite) 5. which will not be impacted by the failure of any individual test setup (obviously, the failure of the messagequeue input should not impact testing the storage account)</p>
<h2 id="how" tabindex="-1"><a class="direct-link" href="#how">How</a></h2>
<p>This is my &quot;reasonable&quot; solution to the problem. I walk through each step to explain it. Skip ahead to the <a href="#full-solution">full solution</a></p>
<ol>
<li>Several tests : Nothing complicated. The <code>order</code> fixture lets us see the execution order of fixtures. It has a <code>session</code> scope so it lasts across all of our tests. It also stands in for other common dependencies, like credentials or whatever.</li>
</ol>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token keyword">import</span> pytest</span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"session"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="highlight-line">	<span class="token keyword">yield</span> x</span>
<span class="highlight-line">	<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">test_0</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"test_0"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">test_1</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"test_1"</span><span class="token punctuation">)</span></span></code></pre>
<ol start="2">
<li>With individual fixtures : these are our setup filters. They're straightforward for now, but we'll need to make some modifications to them later. The first thing we'll do is to mark them with a <code>class</code> scope, which will be used to make them run only once. It might not be necessary because of pytest's fun fixture scoping rules, but I just mark them this way since it doesn't really make a difference to me.</li>
</ol>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token keyword">import</span> pytest</span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">setup_0</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"setup_0"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">setup_1</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"setup_1"</span><span class="token punctuation">)</span></span></code></pre>
<ol start="3">
<li>Sharing a common setup step : This is our Big Thing. I've taken inspiration from the pytest page for <a href="https://docs.pytest.org/en/latest/fixture.html#running-multiple-assert-statements-safely">running multiple asserts safely</a>. We make a Test Class to hold all the tests which depend on the big setup. This allows us to create the Big Thing as a class-scoped fixture. The important thing about this fixture is that it is <code>autouse</code>, so it will automatically occur before all the tests. This does force us to put all the tests in this class, but that doesn't seem to be a really hard thing to do.</li>
</ol>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token keyword">import</span> pytest</span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">class</span> <span class="token class-name">TestBatch</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">,</span> autouse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">deploy</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"deploy"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">test_0</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> setup_0<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"test_0"</span><span class="token punctuation">)</span></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">test_1</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> setup_1<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"test_1"</span><span class="token punctuation">)</span></span></code></pre>
<ol start="4">
<li>Which occurs after the individual setups : Unfortunately, this doesn't <em>quite</em> work, since the <code>setup</code> operations don't have to occur before the <code>deploy</code>. So we need to add them as dependencies to the <code>deploy</code> operation. The duplication of these setups is a bit not great. If I figure something better out I'll let you know. I think it's still reasonably fine to say that there's an extra step to register something as needing to happened before the deploy</li>
</ol>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token keyword">import</span> pytest</span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">class</span> <span class="token class-name">TestBatch</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">,</span> autouse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">deploy</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">,</span> setup_0<span class="token punctuation">,</span> setup_1<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"deploy"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">test_0</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> setup_0<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"test_0"</span><span class="token punctuation">)</span></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">test_1</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> setup_1<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"test_1"</span><span class="token punctuation">)</span></span></code></pre>
<ol start="5">
<li>Which will not be impacted by the failure of any individual test setup : You may have notices that since the <code>setup</code> are fixture dependencies of <code>deploy</code>, their failure will cause the whole <code>deploy</code> to not start and all the tests to fail. So we'll have a fun way of catching those exceptions, and we'll explode them in the relevant test, so that only that test fails. It's not the greatest that you have to do this for all the setups.</li>
</ol>
<p>:/conftest.py</p>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token keyword">import</span> pytest</span>
<span class="highlight-line"><span class="token keyword">from</span> decorator <span class="token keyword">import</span> deorate</span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">shroud</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">_shroud</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		<span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="highlight-line">			<span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></span>
<span class="highlight-line">		<span class="token keyword">except</span><span class="token punctuation">:</span></span>
<span class="highlight-line">			<span class="token keyword">return</span> e</span>
<span class="highlight-line">	<span class="token keyword">return</span> decorate<span class="token punctuation">(</span>f<span class="token punctuation">,</span> _belt<span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">unshroud</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	<span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> Exception<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		<span class="token keyword">raise</span> a</span>
<span class="highlight-line">	<span class="token keyword">return</span> a</span></code></pre>
<p>:/test.py</p>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token keyword">import</span> pytest</span>
<span class="highlight-line"><span class="token keyword">from</span> conftest <span class="token keyword">import</span> shroud<span class="token punctuation">,</span> unshroud</span>
<span class="highlight-line"></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">import</span> pytest</span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@shroud</span></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">setup_0</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"setup_0"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@shroud</span></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">setup_1</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"setup_1"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">class</span> <span class="token class-name">TestBatch</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">,</span> autouse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">deploy</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">,</span> setup_0<span class="token punctuation">,</span> setup_1<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"deploy"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">test_0</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">,</span> setup_0<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		unshroud<span class="token punctuation">(</span>setup_0<span class="token punctuation">)</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"test_0"</span><span class="token punctuation">)</span></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">test_1</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">,</span> setup_1<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		unshroud<span class="token punctuation">(</span>setup_1<span class="token punctuation">)</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"test_1"</span><span class="token punctuation">)</span></span></code></pre>
<h2 id="full-solution" tabindex="-1"><a class="direct-link" href="#full-solution">Full Solution</a></h2>
<p>:/conftest.py</p>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token keyword">import</span> pytest</span>
<span class="highlight-line"><span class="token keyword">from</span> decorator <span class="token keyword">import</span> deorate</span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">shroud</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">_shroud</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		<span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="highlight-line">			<span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></span>
<span class="highlight-line">		<span class="token keyword">except</span><span class="token punctuation">:</span></span>
<span class="highlight-line">			<span class="token keyword">return</span> e</span>
<span class="highlight-line">	<span class="token keyword">return</span> decorate<span class="token punctuation">(</span>f<span class="token punctuation">,</span> _belt<span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">unshroud</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	<span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> Exception<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		<span class="token keyword">raise</span> a</span>
<span class="highlight-line">	<span class="token keyword">return</span> a</span></code></pre>
<p>:/test.py</p>
<pre class="language-python"><code class="language-python"><span class="highlight-line"><span class="token keyword">import</span> pytest</span>
<span class="highlight-line"><span class="token keyword">from</span> conftest <span class="token keyword">import</span> shroud<span class="token punctuation">,</span> unshroud</span>
<span class="highlight-line"></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">import</span> pytest</span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@shroud</span></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">setup_0</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"setup_0"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@shroud</span></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">setup_1</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"setup_1"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"><span class="token decorator annotation punctuation">@shroud</span></span>
<span class="highlight-line"><span class="token keyword">def</span> <span class="token function">setup_failing</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	<span class="token triple-quoted-string string">""" This setup fails, but only test_failing will fail """</span></span>
<span class="highlight-line">	order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"setup_failing"</span><span class="token punctuation">)</span></span>
<span class="highlight-line">	raisse Exception<span class="token punctuation">(</span><span class="token string">"setup failure"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">class</span> <span class="token class-name">TestBatch</span><span class="token punctuation">:</span></span>
<span class="highlight-line">	<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"class"</span><span class="token punctuation">,</span> autouse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">deploy</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">,</span> setup_0<span class="token punctuation">,</span> setup_1<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"deploy"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">test_0</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">,</span> setup_0<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		unshroud<span class="token punctuation">(</span>setup_0<span class="token punctuation">)</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"test_0"</span><span class="token punctuation">)</span></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">test_1</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> order<span class="token punctuation">,</span> setup_1<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		unshroud<span class="token punctuation">(</span>setup_1<span class="token punctuation">)</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"test_1"</span><span class="token punctuation">)</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">	<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>xfail</span></span>
<span class="highlight-line">	<span class="token keyword">def</span> <span class="token function">test_failing</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> setup_failing<span class="token punctuation">,</span> order<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"test_failing_begin"</span><span class="token punctuation">)</span></span>
<span class="highlight-line">		unshroud<span class="token punctuation">(</span>setup_failing<span class="token punctuation">)</span></span>
<span class="highlight-line">		order<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"unshrouding will cause this not to appear"</span><span class="token punctuation">)</span></span></code></pre>

</div>
</article>



<hr>
<ul><li>Next: <a href="/posts/changing_password_on_kartoza_osm/">Changing the password on kartoza/docker-osm</a></li><li>Previous: <a href="/posts/fun_with_adodotnet/">Fun with ADO.NET</a></li>
</ul>

		</main>
		<nav class="nav">
			<ul>
				<li class="nav-item"><a
						href="/">Home</a></li>
				<li class="nav-item"><a
						href="/posts/">Archive</a></li>
				<li class="nav-item"><a
						href="/tags/">Tags</a></li>
				<li class="nav-item"><a
						href="/series/">Series</a></li>
				<li class="nav-item"><a
						href="/about/">About Me</a></li>
				<li class="nav-item"><a
						href="/colophon/">Colophon</a></li>
				<li class="nav-item"><a
						href="/feedlist/">Feeds</a></li>
			</ul>
		</nav>
	</div>
</div>
<footer></footer>

<!-- Current page: /posts/pytest_for_functional_tests/ -->
</body>
</html>
