<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Eleventy Include Code File Verbatim</title>
	<meta name="description" content="An Eleventy shortcode to include a code file verbatim">
	<link rel="stylesheet" href="/css/index.css">
	<link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
	<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml"
		  title="lilatomic">
	<link rel="alternate" href="/feed/feed.json" type="application/json"
		  title="lilatomic">
</head>
<body>
<div class="ctn">
	<header>
		<h1 class="home"><a id="home" href="/">lilatomic</a></h1>
	</header>
	<div id="main">
		<main  class="tmpl-post" >

			
<article>
<h1>Eleventy Include Code File Verbatim</h1>

<aside id="tagbox">
<p>Tags</p>

  <a href="/tags/eleventy/" class="post-tag">eleventy</a>
</aside>





<aside id="toc">
	<nav class="toc" >
        <ol><li><a href="#whole-file">Whole file</a></li><li><a href="#partial-files">Partial files</a></li></ol>
      </nav>
</aside>

<div class="content">
<h1 id="eleventy-include-code-file-verbatim" tabindex="-1">Eleventy Include Code File Verbatim <a class="direct-link" href="#eleventy-include-code-file-verbatim">#</a></h1>
<p>I didn't find what I needed, so I wrote it. It was pretty simple. In your &quot;.eleventy.js&quot; file, somewhere in the big <code>module.exports</code> function, add this little snippet:</p>
<h2 id="whole-file" tabindex="-1">Whole file <a class="direct-link" href="#whole-file">#</a></h2>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> resource_path <span class="token operator">=</span> <span class="token string">"_includes/resources/"</span><span class="token punctuation">;</span></span>
<span class="highlight-line">eleventyConfig<span class="token punctuation">.</span><span class="token function">addShortcode</span><span class="token punctuation">(</span><span class="token string">"include_raw"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">	<span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>resource_path <span class="token operator">+</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p>Then just toss your files into something in the <code>resource_path</code> folder and reference them from your code like so:</p>
<pre class="language-jinja2"><code class="language-jinja2"><span class="highlight-line">	```python</span>
<span class="highlight-line">	<span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">include_raw</span> <span class="token string">"ansible_plugins/filter/filter_as_function.py"</span> <span class="token delimiter punctuation">%}</span></span></span>
<span class="highlight-line">	```</span></code></pre>
<h2 id="partial-files" tabindex="-1">Partial files <a class="direct-link" href="#partial-files">#</a></h2>
<p>I found that I wanted to include only a few lines from a file, but still wanted those lines to exist in context. This allows me to test those lines. It also allows other tools to act on the full file. The motivating example was Bicep files, which get rendered to ARM templates. These have to be syntactically valid to be rendered. But if all I wanted to show was how a line is rendered, including all the boilerplate (especially in the verbose ARM template) is just clutter for the article. So I modified the above to have this:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> resource_path <span class="token operator">=</span> <span class="token string">"_includes/resources/"</span><span class="token punctuation">;</span></span>
<span class="highlight-line">eleventyConfig<span class="token punctuation">.</span><span class="token function">addShortcode</span><span class="token punctuation">(</span></span>
<span class="highlight-line">	<span class="token string">"include_raw"</span><span class="token punctuation">,</span></span>
<span class="highlight-line">	<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> start <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">		<span class="token keyword">let</span> lines <span class="token operator">=</span> fs</span>
<span class="highlight-line">			<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>resource_path <span class="token operator">+</span> path<span class="token punctuation">)</span></span>
<span class="highlight-line">			<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="highlight-line">			<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">		<span class="token keyword">var</span> selected_lines<span class="token punctuation">;</span></span>
<span class="highlight-line">		<span class="token keyword">if</span> <span class="token punctuation">(</span>end <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">			selected_lines <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">			selected_lines <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">		<span class="token punctuation">}</span></span>
<span class="highlight-line">		<span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>selected_lines<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">	<span class="token punctuation">}</span></span>
<span class="highlight-line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p>This is backwards-compatible with the initial pass. The unusual bounds (<a href="https://www.cs.utexas.edu/users/EWD/transcriptions/EWD08xx/EWD831.html">non-dijkstra</a>) make it easy to just look at the line numbers in an editor in the 1-starting convention used by everyone. I would try to persuade everyone to stop using the convention we all make fun of Matlab for, but I already have enough trouble getting <a href="https://www.reddit.com/r/javascript/comments/c8drjo/nobody_talks_about_the_real_reason_to_use_tabs/">the actual accessibility feature of tabs</a> adopted.</p>

</div>
</article>


<hr>
<aside>
<h2>Revisions</h2>
<ol>
  
  <li> 2021-02-24 : first published </li>
  
  <li> 2021-11-15 : add ability to pull in line ranges </li>
  
</ol>
</aside>


<hr>
<ul><li>Next: <a href="/posts/azure_function_durable_testing/">Testing Azure Durable Functions in Python</a></li><li>Previous: <a href="/posts/bicep/">Having fun with Azure Bicep</a></li>
</ul>

		</main>
		<nav class="nav">
			<ul>
				<li class="nav-item"><a
						href="/">Home</a></li>
				<li class="nav-item"><a
						href="/posts/">Archive</a></li>
				<li class="nav-item"><a
						href="/tags/">Tags</a></li>
				<li class="nav-item"><a
						href="/series/">Series</a></li>
				<li class="nav-item"><a
						href="/about/">About Me</a></li>
				<li class="nav-item"><a
						href="/colophon/">Colophon</a></li>
				<li class="nav-item"><a
						href="/feedlist/">Feeds</a></li>
			</ul>
		</nav>
	</div>
</div>
<footer></footer>

<!-- Current page: /posts/eleventy_include_code_verbatim/ -->
</body>
</html>
