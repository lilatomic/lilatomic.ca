<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SSL with Microstack</title>
	<meta name="description" content="Microstack is Openstack in a Snap! let&#39;s add some SSL to it">
	<link rel="stylesheet" href="/css/index.css">
	<link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
	<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml"
		  title="lilatomic">
	<link rel="alternate" href="/feed/feed.json" type="application/json"
		  title="lilatomic">
</head>
<body>
<div class="ctn">
	<header>
		<h1 class="home"><a id="home" href="/">lilatomic</a></h1>
	</header>
	<div id="main">
		<main  class="tmpl-post" >

			
<article>
<h1>SSL with Microstack</h1>

<aside id="tagbox">
<p>Tags</p>

  <a href="/tags/infra/" class="post-tag">infra</a>
  <a href="/tags/openstack/" class="post-tag">openstack</a>
  <a href="/tags/trying/" class="post-tag">trying</a>
</aside>





<aside id="toc">
	<nav class="toc" >
        <ol><li><a href="#setting-up-https-on-horizon-(the-dashboard)">Setting up HTTPS on Horizon (the dashboard)</a></li><li><a href="#ssl-cert">SSL Cert</a></li><li><a href="#nginx">Nginx</a></li></ol>
      </nav>
</aside>

<div class="content">
<h1 id="ssl-with-microstack" tabindex="-1">SSL with Microstack <a class="direct-link" href="#ssl-with-microstack">#</a></h1>
<h2 id="setting-up-https-on-horizon-(the-dashboard)" tabindex="-1">Setting up HTTPS on Horizon (the dashboard) <a class="direct-link" href="#setting-up-https-on-horizon-(the-dashboard)">#</a></h2>
<p>Let's follow the docs <a href="https://docs.openstack.org/horizon/latest/admin/customize-configure.html#configure-dashboard">here</a></p>
<p>The config files for microstack are all in the snap directory, so look in <code>/var/snap/microstack/common/etc</code>. We want to change the hostname by replacing the relevant lines:</p>
<p>:/common/etc/local_settings.d/_05_snap_tweaks.py</p>
<pre class="language-python"><code class="language-python"><span class="highlight-line">OPENSTACK_HOST <span class="token operator">=</span> <span class="token string">""</span></span>
<span class="highlight-line">ALLOWED_HOSTS <span class="token operator">=</span> <span class="token string">""</span></span></code></pre>
<h2 id="ssl-cert" tabindex="-1">SSL Cert <a class="direct-link" href="#ssl-cert">#</a></h2>
<p>I tossed my cert and key into :/common/etc/ssl/private . Make sure to give it appropriate permissions</p>
<h2 id="nginx" tabindex="-1">Nginx <a class="direct-link" href="#nginx">#</a></h2>
<p>The config for horizon lives in :/common/etc/nginx/snap/sites-enabled/horizon.conf . I replaced the <code>listen</code> directive, gave it a <code>server_name</code>, and added the <code>ssl_certificate</code> and <code>ssl_certificate_key</code>. I found that giving the absolute path to the SSL folder worked. That gives us:</p>
<pre class="language-nginx"><code class="language-nginx"><span class="highlight-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="highlight-line">	<span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span></span>
<span class="highlight-line">	<span class="token directive"><span class="token keyword">server_name</span> alpacloud.lilatomic.ca</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">	<span class="token directive"><span class="token keyword">ssl_certificate</span> /var/snap/microstack/common/etc/ssl/private/certificate.pem</span><span class="token punctuation">;</span></span>
<span class="highlight-line">	<span class="token directive"><span class="token keyword">ssl_certificate_key</span> /var/snap/microstack/common/etc/ssl/private/private-key.pem</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">	<span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">16G</span></span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">	<span class="token directive"><span class="token keyword">error_log</span> syslog:server=unix:/dev/log</span><span class="token punctuation">;</span></span>
<span class="highlight-line">	<span class="token directive"><span class="token keyword">access_log</span> syslog:server=unix:/dev/log</span><span class="token punctuation">;</span></span>
<span class="highlight-line">	<span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">		<span class="token directive"><span class="token keyword">include</span> /snap/microstack/222/usr/conf/uwsgi_params</span><span class="token punctuation">;</span></span>
<span class="highlight-line">		<span class="token directive"><span class="token keyword">uwsgi_param</span> SCRIPT_NAME <span class="token string">''</span></span><span class="token punctuation">;</span></span>
<span class="highlight-line">		<span class="token directive"><span class="token keyword">uwsgi_pass</span> unix:///var/snap/microstack/common/run/horizon.sock</span><span class="token punctuation">;</span></span>
<span class="highlight-line">	<span class="token punctuation">}</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span>
<span class="highlight-line"></span></code></pre>

</div>
</article>



<hr>
<ul><li>Next: <a href="/posts/ansible_writing_action_plugin/">Writing an Action Plugin in Ansible</a></li><li>Previous: <a href="/posts/changing_password_on_kartoza_osm/">Changing the password on kartoza/docker-osm</a></li>
</ul>

		</main>
		<nav class="nav">
			<ul>
				<li class="nav-item"><a
						href="/">Home</a></li>
				<li class="nav-item"><a
						href="/posts/">Archive</a></li>
				<li class="nav-item"><a
						href="/tags/">Tags</a></li>
				<li class="nav-item"><a
						href="/series/">Series</a></li>
				<li class="nav-item"><a
						href="/about/">About Me</a></li>
				<li class="nav-item"><a
						href="/colophon/">Colophon</a></li>
				<li class="nav-item"><a
						href="/feedlist/">Feeds</a></li>
			</ul>
		</nav>
	</div>
</div>
<footer></footer>

<!-- Current page: /posts/microstack/ -->
</body>
</html>
