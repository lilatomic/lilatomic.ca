<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Fun with ADO.NET</title>
	<meta name="description" content="Things I&#39;ve figured out about ADO.NET">
	<link rel="stylesheet" href="/css/index.css">
	<link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
	<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml"
		  title="lilatomic">
	<link rel="alternate" href="/feed/feed.json" type="application/json"
		  title="lilatomic">
</head>
<body>
<div class="ctn">
	<header>
		<h1 class="home"><a id="home" href="/">lilatomic</a></h1>
	</header>
	<div id="main">
		<main  class="tmpl-post" >

			
<article>
<h1>Fun with ADO.NET</h1>

<aside id="tagbox">
<p>Tags</p>

  <a href="/tags/VB/" class="post-tag">VB</a>
  <a href="/tags/dotnet/" class="post-tag">dotnet</a>
  <a href="/tags/hindsight/" class="post-tag">hindsight</a>
</aside>





<aside id="toc">
	<nav class="toc" >
        <ol><li><a href="#column-is-not-in-table%2C-but-it-definitely-is">Column is not in Table, but it definitely is</a><ol><li><a href="#problem">Problem</a></li><li><a href="#possible-cause">Possible Cause</a></li></ol></li></ol>
      </nav>
</aside>

<div class="content">
<h1 id="fun-with-ado.net" tabindex="-1">Fun with <a href="http://ADO.NET">ADO.NET</a> <a class="direct-link" href="#fun-with-ado.net">#</a></h1>
<h2 id="column-is-not-in-table%2C-but-it-definitely-is" tabindex="-1">Column is not in Table, but it definitely is <a class="direct-link" href="#column-is-not-in-table%2C-but-it-definitely-is">#</a></h2>
<h3 id="problem" tabindex="-1">Problem <a class="direct-link" href="#problem">#</a></h3>
<p>Maybe you've got some code which is like the following, which accesses a field by a column reference. This particular snippet converts DBNull to Nothing (null), which is kinda useful I guess.</p>
<pre class="language-vb"><code class="language-vb"><span class="highlight-line"><span class="token keyword">Public</span> <span class="token keyword">Shared</span> <span class="token keyword">Function</span> GetField<span class="token punctuation">(</span><span class="token keyword">ByVal</span> row <span class="token keyword">As</span> EntityBase<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> field <span class="token keyword">As</span> DataColumn<span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Object</span></span>
<span class="highlight-line">	<span class="token keyword">Dim</span> obj <span class="token keyword">As</span> <span class="token keyword">Object</span> <span class="token operator">=</span> row<span class="token punctuation">.</span>DataRow<span class="token punctuation">.</span>Item<span class="token punctuation">(</span>field<span class="token punctuation">)</span></span>
<span class="highlight-line">	<span class="token keyword">If</span> <span class="token keyword">TypeOf</span> obj <span class="token keyword">Is</span> DBNull <span class="token keyword">Then</span></span>
<span class="highlight-line">		<span class="token keyword">Return</span> <span class="token boolean">Nothing</span></span>
<span class="highlight-line">	<span class="token keyword">End</span> <span class="token keyword">If</span></span>
<span class="highlight-line">	<span class="token keyword">Return</span> obj</span>
<span class="highlight-line"><span class="token keyword">End</span> <span class="token keyword">Function</span></span></code></pre>
<p>You might find that you're getting some error about <code>&quot;Column '' does not belong to table .&quot;</code>, but you are 100% sure that the column actually is there. Maybe you've even cracked it open in the debugger and checked that the Table definitely has that column.</p>
<h3 id="possible-cause" tabindex="-1">Possible Cause <a class="direct-link" href="#possible-cause">#</a></h3>
<p>One possibility is that the Columns are actually checked by reference equality, not value equality. So if you somehow have a new or different instance of the Table, the Column from one will not be found in the other. This could happen if you've recreated the DB but haven't updated things which reference columns. For example, maybe the application has a handy &quot;reload data&quot; button which recreates the tables and reloads from the DB, but doesn't purge an in-memory list (maybe it's even tightly bound in a UI component). Another way you could end up with different DBs is in tests. You might create and seed a Table, and separately reference columns from a Table inside your test.</p>
<p>For extra fun, this doesn't seem to be a problem in the .Net Framework 2, but <em>is</em> in the .Net Framework 4. So that's exciting.</p>

</div>
</article>



<hr>
<ul><li>Next: <a href="/posts/pytest_for_functional_tests/">Using Pytest for Testing Deployments</a></li><li>Previous: <a href="/posts/dhall_common_tasks_for_config_files/">Common Dhall Tasks for Config Files</a></li>
</ul>

		</main>
		<nav class="nav">
			<ul>
				<li class="nav-item"><a
						href="/">Home</a></li>
				<li class="nav-item"><a
						href="/posts/">Archive</a></li>
				<li class="nav-item"><a
						href="/tags/">Tags</a></li>
				<li class="nav-item"><a
						href="/series/">Series</a></li>
				<li class="nav-item"><a
						href="/about/">About Me</a></li>
				<li class="nav-item"><a
						href="/colophon/">Colophon</a></li>
				<li class="nav-item"><a
						href="/feedlist/">Feeds</a></li>
			</ul>
		</nav>
	</div>
</div>
<footer></footer>

<!-- Current page: /posts/fun_with_adodotnet/ -->
</body>
</html>
